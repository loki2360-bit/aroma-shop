<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Кабинет оператора</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root {
  --bg: #2d2d2d;
  --card: #3a3a3a;
  --text: #ffffff;
  --text-muted: #bbbbbb;
  --accent: #ffeb3b;
  --shadow-light: #444444;
  --shadow-dark: #222222;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

body {
  background: var(--bg);
  color: var(--text);
  padding: 0;
  min-height: 100vh;
  line-height: 1.5;
}

/* Боковое меню */
.sidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: 240px;
  height: 100vh;
  background: var(--card);
  padding: 20px 0;
  z-index: 100;
  box-shadow: 8px 0 20px rgba(0,0,0,0.4);
}
.sidebar-item {
  padding: 14px 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 12px;
  color: var(--text-muted);
  transition: all 0.2s;
  border-radius: 0 12px 12px 0;
  margin: 0 8px;
}
.sidebar-item:hover,
.sidebar-item.active {
  color: var(--accent);
  background: var(--card);
  box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light);
}
.sidebar-item i {
  width: 24px;
  text-align: center;
  font-size: 18px;
}

/* Основной контент */
.main-content {
  margin-left: 240px;
  padding: 24px;
  max-width: 768px;
  margin: 0 auto;
}
.container {
  background: var(--card);
  border-radius: 16px;
  padding: 20px;
  box-shadow: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light);
  margin-bottom: 24px;
}

/* Неоморфические кнопки */
.neu-btn {
  background: var(--card);
  border: none;
  border-radius: 12px;
  padding: 12px 16px;
  font-weight: 600;
  color: var(--text);
  cursor: pointer;
  box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light);
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}
.neu-btn:active {
  box-shadow: inset -2px -2px 5px var(--shadow-dark), inset 2px 2px 5px var(--shadow-light);
}
.neu-btn-accent {
  background: var(--accent);
  color: #000;
  box-shadow: 
    0 0 12px rgba(255, 235, 59, 0.5),
    inset 2px 2px 5px rgba(200, 180, 0, 0.3),
    inset -2px -2px 5px rgba(255, 255, 255, 0.3);
}
.neu-btn-accent:active {
  box-shadow: 
    0 0 8px rgba(255, 235, 59, 0.4),
    inset -2px -2px 5px rgba(200, 180, 0, 0.3),
    inset 2px 2px 5px rgba(255, 255, 255, 0.3);
}

/* Неоморфические поля */
.neu-input,
.neu-select {
  background: var(--card);
  border: none;
  border-radius: 10px;
  padding: 10px 14px;
  color: var(--text);
  box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light);
  width: 100%;
}
.neu-input:focus,
.neu-select:focus {
  outline: none;
  box-shadow: 
    inset 2px 2px 5px var(--shadow-dark), 
    inset -2px -2px 5px var(--shadow-light),
    0 0 8px rgba(255, 235, 59, 0.4);
}

/* Прогресс-бары (неоморфические) */
.progress-container {
  height: 24px;
  background: var(--card);
  border-radius: 12px;
  overflow: hidden;
  margin: 12px 0;
  box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light);
  position: relative;
}
.progress-fill {
  height: 100%;
  border-radius: 12px;
  background: var(--accent);
  box-shadow: 0 0 12px rgba(255, 235, 59, 0.5);
  width: 0;
  transition: width 1.2s cubic-bezier(0.22, 0.61, 0.36, 1);
  position: relative;
}
.progress-label {
  display: flex;
  justify-content: space-between;
  margin-top: 6px;
  font-size: 0.95rem;
}
.progress-title {
  font-weight: 600;
  color: var(--accent);
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

/* Статистика: диаграмма */
.chart-container {
  background: var(--card);
  border-radius: 16px;
  padding: 20px;
  margin: 24px 0;
  box-shadow: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light);
}
.chart-title {
  font-size: 1.2rem;
  font-weight: 600;
  margin-bottom: 16px;
  color: var(--accent);
}
.bar-item {
  margin: 12px 0;
}
.bar-label {
  display: flex;
  justify-content: space-between;
  margin-bottom: 4px;
  font-size: 0.95rem;
}
.bar-container {
  height: 28px;
  background: var(--card);
  border-radius: 14px;
  overflow: hidden;
  box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light);
}
.bar-fill {
  height: 100%;
  background: var(--accent);
  border-radius: 14px;
  width: 0;
  transition: width 1.4s cubic-bezier(0.22, 0.61, 0.36, 1);
  box-shadow: 0 0 10px rgba(255, 235, 59, 0.4);
}

/* Скрытие контента */
.content-block {
  display: none;
}
.content-block.active {
  display: block;
  animation: fadeIn 0.5s ease-out;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
</head>
<body>

<!-- Боковое меню -->
<div class="sidebar">
  <div class="sidebar-item active" data-target="main">
    <i class="fas fa-home"></i> Основное
  </div>
  <div class="sidebar-item" data-target="preorders">
    <i class="fas fa-clock"></i> Предзаказы
  </div>
  <div class="sidebar-item" data-target="stats">
    <i class="fas fa-chart-bar"></i> Статистика
  </div>
</div>

<!-- Основной контент -->
<div class="main-content">
  <!-- Основное -->
  <div id="main" class="content-block active">
    <div class="container">
      <h2 style="margin-bottom: 16px; color: var(--accent);"><i class="fas fa-bullseye"></i> План на смену</h2>
      <div class="progress-container">
        <div class="progress-fill" id="planProgress"></div>
      </div>
      <div class="progress-label">
        <span>Текущая смена</span>
        <span><b id="todayEarned">0.00 ₽</b></span>
      </div>
      
      <div style="margin: 24px 0;">
        <button class="neu-btn neu-btn-accent" onclick="startShift()">
          <i class="fas fa-play"></i> Начать смену
        </button>
        <button class="neu-btn neu-btn-accent" onclick="endShift()" style="margin-left: 12px;">
          <i class="fas fa-stop"></i> Завершить смену
        </button>
      </div>

      <h3 style="margin: 24px 0 12px; color: var(--accent);"><i class="fas fa-plus"></i> Новый заказ</h3>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
        <div>
          <label style="display: block; margin-bottom: 6px;">№ заказа</label>
          <input type="text" id="orderNum" class="neu-input" placeholder="ORD-001">
        </div>
        <div>
          <label style="display: block; margin-bottom: 6px;">Тариф</label>
          <select id="tariff" class="neu-select">
            <option value="RASPIL_M2">Распил — 65 ₽/м²</option>
            <option value="LINEAR_RASPIL">Лин. распил — 26 ₽/м</option>
            <option value="SKLEIKA_OB">Склейка + — 210 ₽/м²</option>
            <option value="SKLEIKA_NO_OB">Склейка – — 165 ₽/м²</option>
            <option value="PAZY">Пазы — 30 ₽/м</option>
            <option value="FREZER_FASKA">Фаска — 16 ₽/м</option>
            <option value="TIME">Время — 330 ₽/ч</option>
          </select>
        </div>
      </div>
      <button class="neu-btn neu-btn-accent" onclick="createMainOrder()">
        <i class="fas fa-check"></i> Создать заказ
      </button>
    </div>
  </div>

  <!-- Предзаказы -->
  <div id="preorders" class="content-block">
    <div class="container">
      <h2 style="margin-bottom: 16px; color: var(--accent);"><i class="fas fa-clock"></i> Предзаказы</h2>
      <p style="color: var(--text-muted); margin-bottom: 20px;">Сохраняйте заказы заранее</p>
      <button class="neu-btn neu-btn-accent" onclick="alert('Функция предзаказов в разработке')">
        <i class="fas fa-save"></i> Добавить предзаказ
      </button>
    </div>
  </div>

  <!-- Статистика -->
  <div id="stats" class="content-block">
    <div class="container">
      <h2 style="margin-bottom: 16px; color: var(--accent);"><i class="fas fa-chart-bar"></i> Общая статистика</h2>
      
      <!-- Прогресс: погонные метры -->
      <div class="progress-title">
        <i class="fas fa-ruler-horizontal"></i> Погонные метры
      </div>
      <div class="progress-container">
        <div class="progress-fill" id="linearProgress"></div>
      </div>
      <div class="progress-label">
        <span>Всего</span>
        <span><b id="linearTotal">0</b> м</span>
      </div>

      <!-- Прогресс: квадратные метры -->
      <div class="progress-title">
        <i class="fas fa-border-all"></i> Квадратные метры
      </div>
      <div class="progress-container">
        <div class="progress-fill" id="areaProgress"></div>
      </div>
      <div class="progress-label">
        <span>Всего</span>
        <span><b id="areaTotal">0</b> м²</span>
      </div>

      <!-- Прогресс: часы -->
      <div class="progress-title">
        <i class="fas fa-clock"></i> Время работы
      </div>
      <div class="progress-container">
        <div class="progress-fill" id="timeProgress"></div>
      </div>
      <div class="progress-label">
        <span>Всего</span>
        <span><b id="timeTotal">0</b> ч</span>
      </div>

      <!-- Диаграмма частоты операций -->
      <div class="chart-container">
        <div class="chart-title">
          <i class="fas fa-tasks"></i> Популярность операций
        </div>
        <div id="operationsChart">
          <!-- Заполняется JS -->
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// === Утилиты ===
function loadOrders() {
  try {
    return JSON.parse(localStorage.getItem('operator_orders') || '[]');
  } catch (e) { return []; }
}

// === Подсчёт статистики ===
function calculateStats() {
  const orders = loadOrders();
  let totalLinear = 0;
  let totalArea = 0;
  let totalTime = 0;
  const operationCount = {
    RASPIL_M2: 0,
    LINEAR_RASPIL: 0,
    SKLEIKA_OB: 0,
    SKLEIKA_NO_OB: 0,
    PAZY: 0,
    FREZER_FASKA: 0,
    TIME: 0
  };

  orders.forEach(o => {
    if (o.tariff === 'LINEAR_RASPIL' || o.tariff === 'PAZY' || o.tariff === 'FREZER_FASKA') {
      totalLinear += (o.length || 0) * (o.qty || 1);
    } else if (o.tariff === 'RASPIL_M2' || o.tariff === 'SKLEIKA_OB' || o.tariff === 'SKLEIKA_NO_OB') {
      totalArea += (o.length || 0) * (o.width || 0) * (o.qty || 1);
    } else if (o.tariff === 'TIME') {
      totalTime += (o.hours || 0) * (o.qty || 1);
    }
    operationCount[o.tariff] = (operationCount[o.tariff] || 0) + 1;
  });

  // Максимумы для шкал (можно настроить)
  const MAX_LINEAR = 1000; // метров
  const MAX_AREA = 200;   // м²
  const MAX_TIME = 100;   // часов

  return {
    linear: { value: totalLinear, percent: Math.min(100, totalLinear / MAX_LINEAR * 100) },
    area: { value: totalArea, percent: Math.min(100, totalArea / MAX_AREA * 100) },
    time: { value: totalTime, percent: Math.min(100, totalTime / MAX_TIME * 100) },
    operations: operationCount
  };
}

// === Рендер статистики ===
function renderStats() {
  const stats = calculateStats();

  // Прогресс-бары
  document.getElementById('linearTotal').textContent = stats.linear.value.toFixed(1);
  document.getElementById('areaTotal').textContent = stats.area.value.toFixed(1);
  document.getElementById('timeTotal').textContent = stats.time.value.toFixed(1);

  // Задержка для анимации
  setTimeout(() => {
    document.getElementById('linearProgress').style.width = `${stats.linear.percent}%`;
    document.getElementById('areaProgress').style.width = `${stats.area.percent}%`;
    document.getElementById('timeProgress').style.width = `${stats.time.percent}%`;
  }, 300);

  // Диаграмма операций
  const opNames = {
    RASPIL_M2: 'Распил',
    LINEAR_RASPIL: 'Лин. распил',
    SKLEIKA_OB: 'Склейка +',
    SKLEIKA_NO_OB: 'Склейка –',
    PAZY: 'Пазы',
    FREZER_FASKA: 'Фаска',
    TIME: 'Время'
  };

  let maxCount = Math.max(...Object.values(stats.operations));
  if (maxCount === 0) maxCount = 1;

  let chartHtml = '';
  for (const [key, count] of Object.entries(stats.operations)) {
    if (count === 0) continue;
    const percent = (count / maxCount) * 100;
    chartHtml += `
      <div class="bar-item">
        <div class="bar-label">
          <span>${opNames[key]}</span>
          <span>${count}</span>
        </div>
        <div class="bar-container">
          <div class="bar-fill" style="width: ${percent}%;"></div>
        </div>
      </div>
    `;
  }

  document.getElementById('operationsChart').innerHTML = chartHtml || '<p style="color:var(--text-muted); text-align:center;">Нет данных</p>';
}

// === Переключение меню ===
document.querySelectorAll('.sidebar-item').forEach(item => {
  item.addEventListener('click', () => {
    document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
    document.querySelectorAll('.content-block').forEach(c => c.classList.remove('active'));
    
    item.classList.add('active');
    const target = item.dataset.target;
    document.getElementById(target).classList.add('active');

    // Если открыта статистика — пересчитать
    if (target === 'stats') {
      renderStats();
    }
  });
});

// === Фейковые функции для демо ===
function startShift() { alert('Смена начата'); }
function endShift() { alert('Смена завершена'); }
function createMainOrder() { alert('Заказ создан'); }

// === Инициализация ===
document.addEventListener('DOMContentLoaded', () => {
  // Обновить план (демо)
  setTimeout(() => {
    document.getElementById('planProgress').style.width = '45%';
    document.getElementById('todayEarned').textContent = '1350.00 ₽';
  }, 300);
});
</script>
</body>
</html>
