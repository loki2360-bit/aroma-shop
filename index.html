<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>–ö–∞–±–∏–Ω–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root {
--bg-dark: #1a1a1a;
--bg-card: #2d2d2d;
--text-light: #ffffff;
--text-muted: #bbbbbb;
--accent-yellow: #ffeb3b;
--accent-yellow-dark: #fbc02d;
--accent-red: #ff5252;
--accent-red-dark: #ff1744;
--accent-green: #69f0ae;
--accent-green-dark: #00e676;
--border: #444444;
--shadow: rgba(0,0,0,0.3);
}
* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}
body {
background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
color: var(--text-light);
padding: 12px;
min-height: 100vh;
line-height: 1.4;
}
.container {
max-width: 768px;
margin: 0 auto;
background: var(--bg-card);
border-radius: 14px;
box-shadow: 0 6px 20px var(--shadow);
overflow: hidden;
font-size: 15px;
position: relative;
}
/* Tabs */
.tabs {
display: flex;
background: #333333;
border-bottom: 1px solid var(--border);
}
.tab-btn {
flex: 1;
padding: 14px;
background: none;
border: none;
font-weight: 600;
color: var(--text-muted);
cursor: pointer;
transition: all 0.2s;
position: relative;
}
.tab-btn.active {
color: var(--accent-yellow);
background: #252525;
border-bottom: 3px solid var(--accent-yellow);
}
.tab-btn:hover {
color: var(--accent-yellow);
}
/* Header */
.header {
display: flex;
align-items: center;
gap: 14px;
padding: 18px 16px 14px;
background: #252525;
border-bottom: 1px solid var(--border);
}
.avatar {
width: 56px;
height: 56px;
border-radius: 50%;
background: linear-gradient(135deg, var(--accent-yellow), var(--accent-yellow-dark));
display: flex;
align-items: center;
justify-content: center;
font-weight: bold;
color: #000;
font-size: 20px;
flex-shrink: 0;
box-shadow: 0 0 15px rgba(255, 235, 59, 0.4);
}
.info h2 {
font-size: 1.3rem;
font-weight: 600;
margin-bottom: 4px;
}
.info p {
font-size: 1rem;
color: var(--text-muted);
}
/* Plan Box */
.plan-box {
padding: 18px 16px;
background: linear-gradient(135deg, #333333, #2d2d2d);
margin: 16px;
border-radius: 12px;
position: relative;
border: 1px solid var(--border);
}
.plan-title {
font-size: 1.1rem;
font-weight: 600;
margin-bottom: 10px;
display: flex;
align-items: center;
gap: 6px;
color: var(--accent-yellow);
}
.progress-container {
height: 16px;
background: #444444;
border-radius: 8px;
overflow: hidden;
margin: 8px 0;
border: 1px solid #555555;
}
.progress-fill {
height: 100%;
border-radius: 8px;
transition: width 0.4s ease, background 0.4s ease;
}
.progress-text {
display: flex;
justify-content: space-between;
font-size: 0.95rem;
font-weight: 500;
margin-top: 6px;
}
.shift-status {
font-size: 0.9rem;
color: var(--text-muted);
margin-top: 6px;
font-style: italic;
}
/* Section title */
.section-title {
font-size: 1.2rem;
font-weight: 600;
margin: 20px 0 14px;
padding: 0 16px;
display: flex;
align-items: center;
gap: 8px;
color: var(--accent-yellow);
}
/* Form */
.form-grid {
display: grid;
grid-template-columns: 1fr;
gap: 14px;
padding: 0 16px 16px;
}
@media (min-width: 600px) {
.form-grid {
grid-template-columns: 1fr 1fr;
}
}
.form-group {
margin: 0;
}
label {
display: block;
margin-bottom: 6px;
font-weight: 600;
font-size: 0.9rem;
color: var(--text-light);
}
input, select {
width: 100%;
padding: 10px 12px;
border: 1px solid var(--border);
border-radius: 8px;
font-size: 14px;
background: #333333;
color: var(--text-light);
transition: all 0.2s;
}
input:focus, select:focus {
outline: none;
border-color: var(--accent-yellow);
box-shadow: 0 0 0 2px rgba(255, 235, 59, 0.3);
}
.btn-row {
display: flex;
gap: 10px;
padding: 0 16px 16px;
flex-wrap: wrap;
align-items: center;
}
button {
flex: 1;
min-width: 120px;
border: none;
border-radius: 8px;
padding: 11px;
font-weight: 600;
font-size: 14px;
cursor: pointer;
transition: all 0.3s ease;
display: inline-flex;
align-items: center;
justify-content: center;
gap: 6px;
position: relative;
overflow: hidden;
}
/* Toggle Switch */
.toggle-switch {
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  user-select: none;
  font-weight: 600;
  color: var(--text-light);
  padding: 8px 0;
}
.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}
.slider {
  position: relative;
  display: block;
  width: 60px;
  height: 30px;
  background-color: #444;
  border-radius: 30px;
  transition: background-color 0.3s;
}
.slider:before {
  position: absolute;
  content: "";
  height: 26px;
  width: 26px;
  left: 2px;
  bottom: 2px;
  background-color: white;
  border-radius: 50%;
  transition: transform 0.3s;
}
.toggle-switch input:checked + .slider {
  background: linear-gradient(135deg, var(--accent-yellow), var(--accent-yellow-dark));
}
.toggle-switch input:checked + .slider:before {
  transform: translateX(30px);
}

/* Buttons */
.btn-start {
background: linear-gradient(135deg, #00e676, #00c853);
color: #000;
box-shadow: 0 4px 15px rgba(0, 230, 118, 0.3);
}
.btn-start:hover {
box-shadow: 0 4px 20px rgba(0, 230, 118, 0.5), 0 0 20px rgba(0, 230, 118, 0.3);
transform: translateY(-2px);
}
.btn-end {
background: linear-gradient(135deg, #ff5252, #ff1744);
color: white;
box-shadow: 0 4px 15px rgba(255, 82, 82, 0.3);
}
.btn-end:hover {
box-shadow: 0 4px 20px rgba(255, 82, 82, 0.5), 0 0 20px rgba(255, 82, 82, 0.3);
transform: translateY(-2px);
}
.btn-blue {
background: linear-gradient(135deg, #2979ff, #2962ff);
color: white;
box-shadow: 0 4px 15px rgba(41, 121, 255, 0.3);
}
.btn-blue:hover {
box-shadow: 0 4px 20px rgba(41, 121, 255, 0.5), 0 0 20px rgba(41, 121, 255, 0.3);
transform: translateY(-2px);
}
.btn-outline {
background: transparent;
border: 1px solid var(--border);
color: var(--text-light);
box-shadow: 0 4px 15px rgba(100, 100, 100, 0.2);
}
.btn-outline:hover {
border-color: var(--accent-yellow);
color: var(--accent-yellow);
box-shadow: 0 4px 20px rgba(255, 235, 59, 0.3), 0 0 15px rgba(255, 235, 59, 0.2);
transform: translateY(-2px);
}
.btn-accept {
background: linear-gradient(135deg, #00e676, #00c853);
color: #000;
font-size: 13px;
padding: 8px 10px;
box-shadow: 0 4px 15px rgba(0, 230, 118, 0.3);
}
.btn-accept:hover {
box-shadow: 0 4px 20px rgba(0, 230, 118, 0.5), 0 0 20px rgba(0, 230, 118, 0.3);
transform: translateY(-2px);
}
.btn-delete {
background: linear-gradient(135deg, #ff5252, #ff1744);
color: white;
font-size: 13px;
padding: 8px 10px;
min-width: auto;
box-shadow: 0 4px 15px rgba(255, 82, 82, 0.3);
}
.btn-delete:hover {
box-shadow: 0 4px 20px rgba(255, 82, 82, 0.5), 0 0 20px rgba(255, 82, 82, 0.3);
transform: translateY(-2px);
}
.btn-view {
background: linear-gradient(135deg, #ffeb3b, #fbc02d);
color: #000;
font-size: 13px;
padding: 8px 10px;
min-width: auto;
box-shadow: 0 4px 15px rgba(255, 235, 59, 0.3);
}
.btn-view:hover {
box-shadow: 0 4px 20px rgba(255, 235, 59, 0.5), 0 0 20px rgba(255, 235, 59, 0.3);
transform: translateY(-2px);
}
/* Orders list */
.date-label, .preorders-label {
font-weight: 600;
color: var(--accent-yellow);
margin: 16px 0 12px;
padding: 0 16px;
display: block;
}
table {
width: 100%;
border-collapse: collapse;
font-size: 14px;
margin: 0 16px 16px;
}
th {
background: #333333;
padding: 10px 8px;
text-align: left;
font-weight: 600;
border-bottom: 1px solid var(--border);
color: var(--accent-yellow);
}
td {
padding: 10px 8px;
border-bottom: 1px solid #444444;
color: var(--text-light);
}
.amount {
font-weight: 600;
color: var(--accent-green);
}
.empty-msg {
text-align: center;
color: var(--text-muted);
padding: 20px 16px;
font-style: italic;
}
.hint {
text-align: center;
margin: 20px 16px;
padding: 12px;
color: var(--text-muted);
font-size: 13px;
border: 1px dashed var(--border);
border-radius: 8px;
background: #333333;
}
.fade-in {
animation: fadeIn 0.3s ease-out;
}
@keyframes fadeIn {
from { opacity: 0; transform: translateY(8px); }
to { opacity: 1; transform: translateY(0); }
}
.hidden { display: none; }
/* Modal styles */
.modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0,0,0,0.7);
z-index: 1000;
justify-content: center;
align-items: center;
}
.modal.active {
display: flex;
}
.modal-content {
background: linear-gradient(135deg, #2d2d2d, #333333);
padding: 24px;
border-radius: 12px;
max-width: 400px;
width: 90%;
box-shadow: 0 10px 40px rgba(0,0,0,0.5);
border: 1px solid var(--border);
position: relative;
}
.modal-title {
font-size: 1.2rem;
font-weight: 600;
margin-bottom: 16px;
color: var(--accent-yellow);
}
.modal-row {
margin-bottom: 16px;
}
.modal-buttons {
display: flex;
gap: 10px;
justify-content: flex-end;
}
/* Details modal */
.details-item {
display: flex;
justify-content: space-between;
padding: 8px 0;
border-bottom: 1px solid #444444;
}
.details-label {
font-weight: 600;
color: var(--text-light);
}
.details-value {
color: var(--accent-yellow);
}
</style>
</head>
<body>
<div class="container fade-in">
<!-- Tabs -->
<div class="tabs">
<button class="tab-btn active" onclick="switchTab('main')">–û—Å–Ω–æ–≤–Ω–æ–µ</button>
<button class="tab-btn" onclick="switchTab('preorders')">–ü—Ä–µ–¥–∑–∞–∫–∞–∑—ã</button>
</div>
<!-- Main Tab -->
<div id="main-tab">
<!-- Header -->
<div class="header">
<div class="avatar"><i class="fas fa-user"></i></div>
<div class="info">
<h2>–û–ø–µ—Ä–∞—Ç–æ—Ä ‚Ññ<span id="opId">1</span></h2>
<p>–í—Å–µ–≥–æ: <b><span id="totalAll">0.00</span> ‚ÇΩ</b></p>
</div>
</div>
<!-- Plan Box -->
<div class="plan-box">
<div class="plan-title">
<i class="fas fa-bullseye"></i> –ü–ª–∞–Ω: <b>3000 ‚ÇΩ</b>
</div>
<div class="progress-container">
<div class="progress-fill" id="progressFill"></div>
</div>
<div class="progress-text">
<span>–¢–µ–∫—É—â–∞—è —Å–º–µ–Ω–∞:</span>
<span><b><span id="todayEarned">0.00</span> ‚ÇΩ</b></span>
</div>
<div class="shift-status" id="shiftStatus">–°–º–µ–Ω–∞ –Ω–µ –Ω–∞—á–∞—Ç–∞</div>
</div>
<!-- Shift Controls -->
<div class="btn-row">
<button class="btn-start" onclick="startShift()">
<i class="fas fa-play"></i> –ù–∞—á–∞—Ç—å —Å–º–µ–Ω—É
</button>
<button class="btn-end" onclick="endShift()">
<i class="fas fa-stop"></i> –ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–º–µ–Ω—É
</button>
</div>
<!-- Create Order -->
<div class="section-title">
<i class="fas fa-plus"></i> –ù–æ–≤—ã–π –∑–∞–∫–∞–∑
</div>
<div class="form-grid">
<div class="form-group">
<label>‚Ññ –∑–∞–∫–∞–∑–∞</label>
<input type="text" id="orderNum" placeholder="–ù–∞–ø—Ä.: ORD-001" required>
</div>
<div class="form-group">
<label>–¢–∞—Ä–∏—Ñ</label>
<select id="tariff">
<option value="RASPIL_M2">–†–∞—Å–ø–∏–ª ‚Äî 65 ‚ÇΩ/–º¬≤</option>
<option value="LINEAR_RASPIL">–õ–∏–Ω. —Ä–∞—Å–ø–∏–ª ‚Äî 26 ‚ÇΩ/–º</option>
<option value="SKLEIKA_OB">–°–∫–ª–µ–π–∫–∞ + ‚Äî 210 ‚ÇΩ/–º¬≤</option>
<option value="SKLEIKA_NO_OB">–°–∫–ª–µ–π–∫–∞ ‚Äì ‚Äî 165 ‚ÇΩ/–º¬≤</option>
<option value="PAZY">–ü–∞–∑—ã ‚Äî 30 ‚ÇΩ/–º</option>
<option value="FREZER_FASKA">–§–∞—Å–∫–∞ ‚Äî 16 ‚ÇΩ/–º</option>
<option value="TIME">–í—Ä–µ–º—è ‚Äî 330 ‚ÇΩ/—á</option>
</select>
</div>
<div class="form-group">
<label>–î–µ—Ç–∞–ª—å</label>
<input type="text" id="detail" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
</div>
<div class="form-group">
<label>–ö–æ–ª-–≤–æ</label>
<input type="number" id="qty" value="1" min="1">
</div>
<div class="form-group" id="lengthGroup">
<label>–î–ª–∏–Ω–∞ (–º)</label>
<input type="number" step="0.01" id="length" placeholder="0.00">
</div>
<div class="form-group hidden" id="widthGroup">
<label>–®–∏—Ä–∏–Ω–∞ (–º)</label>
<input type="number" step="0.01" id="width" placeholder="0.00">
</div>
<div class="form-group hidden" id="hoursGroup">
<label>–ß–∞—Å—ã</label>
<input type="number" step="0.1" id="hours" placeholder="0.0">
</div>
</div>

<!-- ‚úÖ –ó–ê–ú–ï–ù–ê –ö–ù–û–ü–ö–ò –ù–ê TOGGLE -->
<div class="btn-row">
  <label class="toggle-switch">
    <input type="checkbox" id="createOrderToggle" onchange="handleCreateOrderToggle(this)">
    <span class="slider round"></span>
    <span>–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</span>
  </label>
</div>

<!-- View Orders by Date -->
<div class="section-title">
<i class="fas fa-history"></i> –ó–∞–∫–∞–∑—ã –ø–æ –¥–∞—Ç–µ
</div>
<div class="form-grid">
<div class="form-group">
<label>–î–∞—Ç–∞</label>
<input type="date" id="viewDate" value="">
</div>
</div>
<div class="btn-row">
<button onclick="showOrdersByDate()">
<i class="fas fa-eye"></i> –ü–æ–∫–∞–∑–∞—Ç—å
</button>
<button class="btn-outline" onclick="saveOrdersToFile()">
<i class="fas fa-download"></i> –í TXT
</button>
<button class="btn-outline" onclick="saveOrdersToJSON()">
<i class="fas fa-file-code"></i> –í JSON
</button>
</div>
<div id="ordersList"></div>
</div>
<!-- Preorders Tab -->
<div id="preorders-tab" class="hidden">
<div class="section-title">
<i class="fas fa-clock"></i> –ü—Ä–µ–¥–∑–∞–∫–∞–∑—ã
</div>
<div class="form-grid">
<div class="form-group">
<label>‚Ññ –∑–∞–∫–∞–∑–∞</label>
<input type="text" id="preOrderNum" placeholder="–ù–∞–ø—Ä.: PRE-001" required>
</div>
<div class="form-group">
<label>–¢–∞—Ä–∏—Ñ</label>
<select id="preTariff">
<option value="RASPIL_M2">–†–∞—Å–ø–∏–ª ‚Äî 65 ‚ÇΩ/–º¬≤</option>
<option value="LINEAR_RASPIL">–õ–∏–Ω. —Ä–∞—Å–ø–∏–ª ‚Äî 26 ‚ÇΩ/–º</option>
<option value="SKLEIKA_OB">–°–∫–ª–µ–π–∫–∞ + ‚Äî 210 ‚ÇΩ/–º¬≤</option>
<option value="SKLEIKA_NO_OB">–°–∫–ª–µ–π–∫–∞ ‚Äì ‚Äî 165 ‚ÇΩ/–º¬≤</option>
<option value="PAZY">–ü–∞–∑—ã ‚Äî 30 ‚ÇΩ/–º</option>
<option value="FREZER_FASKA">–§–∞—Å–∫–∞ ‚Äî 16 ‚ÇΩ/–º</option>
<option value="TIME">–í—Ä–µ–º—è ‚Äî 330 ‚ÇΩ/—á</option>
</select>
</div>
<div class="form-group">
<label>–î–µ—Ç–∞–ª—å</label>
<input type="text" id="preDetail" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
</div>
<div class="form-group">
<label>–ö–æ–ª-–≤–æ</label>
<input type="number" id="preQty" value="1" min="1">
</div>
<div class="form-group" id="preLengthGroup">
<label>–î–ª–∏–Ω–∞ (–º)</label>
<input type="number" step="0.01" id="preLength" placeholder="0.00">
</div>
<div class="form-group hidden" id="preWidthGroup">
<label>–®–∏—Ä–∏–Ω–∞ (–º)</label>
<input type="number" step="0.01" id="preWidth" placeholder="0.00">
</div>
<div class="form-group hidden" id="preHoursGroup">
<label>–ß–∞—Å—ã</label>
<input type="number" step="0.1" id="preHours" placeholder="0.0">
</div>
</div>
<div class="btn-row">
<button class="btn-blue" onclick="createPreorder()">
<i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–µ–¥–∑–∞–∫–∞–∑
</button>
<button class="btn-outline" onclick="document.getElementById('jsonImportInput').click()">
<i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å TXT/JSON
</button>
</div>
<input type="file" id="jsonImportInput" accept=".txt,.json" style="display: none;" />
<div class="preorders-label">–°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–∑–∞–∫–∞–∑–æ–≤</div>
<div id="preordersList"></div>
</div>
<div class="hint">
üí° –ü—Ä–µ–¥–∑–∞–∫–∞–∑—ã –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –ø–ª–∞–Ω. –ù–∞–∂–º–∏—Ç–µ ¬´–ü—Ä–∏–Ω—è—Ç—å¬ª, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –≤ –æ—Å–Ω–æ–≤–Ω—ã–µ.
</div>
</div>

<!-- Modals -->
<div id="editModal" class="modal">
<div class="modal-content">
<div class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑</div>
<input type="hidden" id="editOrderId">
<div class="modal-row">
<label>‚Ññ –∑–∞–∫–∞–∑–∞</label>
<input type="text" id="editOrderNum">
</div>
<div class="modal-row">
<label>–î–µ—Ç–∞–ª—å</label>
<input type="text" id="editDetail">
</div>
<div class="modal-row">
<label>–¢–∞—Ä–∏—Ñ</label>
<select id="editTariff">
<option value="RASPIL_M2">–†–∞—Å–ø–∏–ª ‚Äî 65 ‚ÇΩ/–º¬≤</option>
<option value="LINEAR_RASPIL">–õ–∏–Ω. —Ä–∞—Å–ø–∏–ª ‚Äî 26 ‚ÇΩ/–º</option>
<option value="SKLEIKA_OB">–°–∫–ª–µ–π–∫–∞ + ‚Äî 210 ‚ÇΩ/–º¬≤</option>
<option value="SKLEIKA_NO_OB">–°–∫–ª–µ–π–∫–∞ ‚Äì ‚Äî 165 ‚ÇΩ/–º¬≤</option>
<option value="PAZY">–ü–∞–∑—ã ‚Äî 30 ‚ÇΩ/–º</option>
<option value="FREZER_FASKA">–§–∞—Å–∫–∞ ‚Äî 16 ‚ÇΩ/–º</option>
<option value="TIME">–í—Ä–µ–º—è ‚Äî 330 ‚ÇΩ/—á</option>
</select>
</div>
<div class="modal-row">
<label>–ö–æ–ª-–≤–æ</label>
<input type="number" id="editQty" min="1">
</div>
<div class="modal-row" id="editLengthGroup">
<label>–î–ª–∏–Ω–∞ (–º)</label>
<input type="number" step="0.01" id="editLength">
</div>
<div class="modal-row hidden" id="editWidthGroup">
<label>–®–∏—Ä–∏–Ω–∞ (–º)</label>
<input type="number" step="0.01" id="editWidth">
</div>
<div class="modal-row hidden" id="editHoursGroup">
<label>–ß–∞—Å—ã</label>
<input type="number" step="0.1" id="editHours">
</div>
<div class="modal-buttons">
<button class="btn-outline" onclick="closeEditModal()">–û—Ç–º–µ–Ω–∞</button>
<button class="btn-blue" onclick="saveEditedOrder()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>
</div>
</div>

<div id="dateModal" class="modal">
<div class="modal-content">
<div class="modal-title">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –¥–ª—è –∑–∞–∫–∞–∑–∞</div>
<div class="modal-row">
<label>–î–∞—Ç–∞</label>
<input type="date" id="modalDate">
</div>
<div class="modal-buttons">
<button class="btn-outline" onclick="closeDateModal()">–û—Ç–º–µ–Ω–∞</button>
<button class="btn-blue" onclick="confirmDateSelection()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
</div>
</div>
</div>

<div id="detailsModal" class="modal">
<div class="modal-content">
<div class="modal-title">–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞</div>
<div id="detailsContent"></div>
<div class="modal-buttons">
<button class="btn-outline" onclick="closeDetailsModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>
</div>
</div>

<script>
// === –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã ===
const TARIFFS = {
RASPIL_M2: { price: 65, unit: 'm2' },
LINEAR_RASPIL: { price: 26, unit: 'linear' },
SKLEIKA_OB: { price: 210, unit: 'm2' },
SKLEIKA_NO_OB: { price: 165, unit: 'm2' },
PAZY: { price: 30, unit: 'linear' },
FREZER_FASKA: { price: 16, unit: 'linear' },
TIME: { price: 330, unit: 'time' }
};
const TARIFF_NAMES = {
RASPIL_M2: '–†–∞—Å–ø–∏–ª',
LINEAR_RASPIL: '–õ–∏–Ω. —Ä–∞—Å–ø–∏–ª',
SKLEIKA_OB: '–°–∫–ª–µ–π–∫–∞ +',
SKLEIKA_NO_OB: '–°–∫–ª–µ–π–∫–∞ ‚Äì',
PAZY: '–ü–∞–∑—ã',
FREZER_FASKA: '–§–∞—Å–∫–∞',
TIME: '–í—Ä–µ–º—è'
};
const UNIT_LABELS = {
m2: '–º¬≤',
linear: '–ø–æ–≥. –º',
time: '—á–∞—Å—ã'
};

// === –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ===
let hasNotified1000 = false;
let editingOrder = null;
let pendingPreorderId = null;

// === –ê–Ω–∏–º–∞—Ü–∏–∏ ===
const style = document.createElement('style');
style.textContent = `
@keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
@keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
`;
document.head.appendChild(style);

// === –ó–≤—É–∫ ===
function playBellSound() {
try {
const AudioContext = window.AudioContext || window.webkitAudioContext;
if (!AudioContext) return;
const audioContext = new AudioContext();
const frequencies = [600, 800];
let time = audioContext.currentTime;
frequencies.forEach((freq, i) => {
const oscillator = audioContext.createOscillator();
const gainNode = audioContext.createGain();
oscillator.connect(gainNode);
gainNode.connect(audioContext.destination);
oscillator.type = 'sine';
oscillator.frequency.value = freq;
gainNode.gain.setValueAtTime(0.2, time);
gainNode.gain.exponentialRampToValueAtTime(0.01, time + 0.3);
oscillator.start(time);
oscillator.stop(time + 0.3);
time += 0.25;
});
} catch (e) { console.warn('–ó–≤—É–∫ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è:', e); }
}

// === –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ 1000‚ÇΩ ===
function checkAndNotify1000(currentAmount) {
const shift = getCurrentShift();
if (!shift || !shift.active) { hasNotified1000 = false; return; }
if (currentAmount >= 1000 && !hasNotified1000) {
hasNotified1000 = true;
playBellSound();
const notification = document.createElement('div');
notification.innerHTML = `<div style="position:fixed;top:20px;right:20px;background:linear-gradient(135deg,#ffeb3b,#fbc02d);color:#000;padding:16px 24px;border-radius:12px;box-shadow:0 8px 24px rgba(255,235,59,0.4);z-index:2000;font-weight:bold;animation:slideIn 0.3s ease-out,fadeOut 0.5s ease-in 3s forwards;">üéØ –î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ 1000‚ÇΩ!</div>`;
document.body.appendChild(notification);
setTimeout(() => { if (notification.parentNode) notification.parentNode.removeChild(notification); }, 4000);
}
}

// === –£—Ç–∏–ª–∏—Ç—ã ===
function formatDateYMD(dateStr) { const [y,m,d] = dateStr.split('-'); return `${d}.${m}.${y}`; }
function todayYMD() { return new Date().toISOString().split('T')[0]; }
function loadOrders() { try { return JSON.parse(localStorage.getItem('operator_orders') || '[]'); } catch (e) { return []; } }
function saveOrders(orders) { localStorage.setItem('operator_orders', JSON.stringify(orders)); }
function loadPreorders() { try { return JSON.parse(localStorage.getItem('operator_preorders') || '[]'); } catch (e) { return []; } }
function savePreorders(preorders) { localStorage.setItem('operator_preorders', JSON.stringify(preorders)); }
function getCurrentShift() { try { return JSON.parse(localStorage.getItem('current_shift') || 'null'); } catch (e) { return null; } }
function setCurrentShift(shift) { if (shift === null) localStorage.removeItem('current_shift'); else localStorage.setItem('current_shift', JSON.stringify(shift)); }

// === –†–∞—Å—á—ë—Ç ===
function calculateAmount(tariffKey, length, width, hours, qty) {
const tariff = TARIFFS[tariffKey];
if (!tariff) return 0;
let amount = 0;
if (tariff.unit === 'time') amount = tariff.price * hours * qty;
else if (tariff.unit === 'm2') amount = tariff.price * length * width * qty;
else amount = tariff.price * length * qty;
return Math.round(amount * 100) / 100;
}
function calculateUnits(tariffKey, length, width, hours, qty) {
const tariff = TARIFFS[tariffKey];
if (!tariff) return { value: 0, unit: '' };
let value = 0, unit = tariff.unit;
if (tariff.unit === 'time') value = hours * qty;
else if (tariff.unit === 'm2') value = length * width * qty;
else value = length * qty;
return { value: Math.round(value * 100) / 100, unit: UNIT_LABELS[unit] || unit };
}

// === UI ===
function updateUI() {
const orders = loadOrders();
const totalAll = orders.reduce((sum, o) => sum + (parseFloat(o.amount) || 0), 0);
const shift = getCurrentShift();
let currentShiftAmount = 0, progressWidth = 0, fillColor = '#444444', statusText = '–°–º–µ–Ω–∞ –Ω–µ –Ω–∞—á–∞—Ç–∞';
if (shift && shift.active) {
currentShiftAmount = orders.filter(o => o.shiftId === shift.id).reduce((sum, o) => sum + (parseFloat(o.amount) || 0), 0);
progressWidth = Math.min(100, (currentShiftAmount / 3000) * 100);
fillColor = `linear-gradient(90deg, #ffeb3b 0%, #fbc02d 50%, #00e676 100%)`;
statusText = '–°–º–µ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞';
checkAndNotify1000(currentShiftAmount);
} else if (shift && !shift.active) {
currentShiftAmount = shift.finalAmount || 0;
progressWidth = Math.min(100, (currentShiftAmount / 3000) * 100);
fillColor = shift.finalAmount >= 3000 ? '#00e676' : '#ff5252';
statusText = '–°–º–µ–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞';
}
document.getElementById('totalAll').textContent = totalAll.toFixed(2);
document.getElementById('todayEarned').textContent = currentShiftAmount.toFixed(2);
const fillEl = document.getElementById('progressFill');
fillEl.style.width = `${progressWidth}%`;
fillEl.style.background = fillColor;
document.getElementById('shiftStatus').textContent = statusText;
}

// === –ü–æ–ª—è —Ñ–æ—Ä–º—ã ===
function updateMainFormFields() {
const tariff = document.getElementById('tariff').value;
document.getElementById('widthGroup').classList.toggle('hidden', !['RASPIL_M2','SKLEIKA_OB','SKLEIKA_NO_OB'].includes(tariff));
document.getElementById('hoursGroup').classList.toggle('hidden', tariff !== 'TIME');
document.getElementById('lengthGroup').classList.toggle('hidden', tariff === 'TIME');
}
function updatePreorderFormFields() {
const tariff = document.getElementById('preTariff').value;
document.getElementById('preWidthGroup').classList.toggle('hidden', !['RASPIL_M2','SKLEIKA_OB','SKLEIKA_NO_OB'].includes(tariff));
document.getElementById('preHoursGroup').classList.toggle('hidden', tariff !== 'TIME');
document.getElementById('preLengthGroup').classList.toggle('hidden', tariff === 'TIME');
}
function updateEditFormFields() {
const tariff = document.getElementById('editTariff').value;
document.getElementById('editWidthGroup').classList.toggle('hidden', !['RASPIL_M2','SKLEIKA_OB','SKLEIKA_NO_OB'].includes(tariff));
document.getElementById('editHoursGroup').classList.toggle('hidden', tariff !== 'TIME');
document.getElementById('editLengthGroup').classList.toggle('hidden', tariff === 'TIME');
}

// === –°–º–µ–Ω—ã ===
function startShift() {
const shift = getCurrentShift();
if (shift && shift.active) { alert('–°–º–µ–Ω–∞ —É–∂–µ –∞–∫—Ç–∏–≤–Ω–∞!'); return; }
setCurrentShift({ id: Date.now(), startedAt: new Date().toISOString(), active: true });
playBellSound(); alert('‚úÖ –°–º–µ–Ω–∞ –Ω–∞—á–∞—Ç–∞!'); updateUI();
}
function endShift() {
const shift = getCurrentShift();
if (!shift || !shift.active) { alert('–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å–º–µ–Ω—ã –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è!'); return; }
const finalAmount = loadOrders().filter(o => o.shiftId === shift.id).reduce((sum, o) => sum + (parseFloat(o.amount) || 0), 0);
shift.active = false; shift.finishedAt = new Date().toISOString(); shift.finalAmount = finalAmount;
setCurrentShift(shift); playBellSound();
alert(`‚úÖ –°–º–µ–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\n–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: ${finalAmount.toFixed(2)} ‚ÇΩ`);
updateUI();
}

// === –û–±—Ä–∞–±–æ—Ç–∫–∞ toggle ===
function handleCreateOrderToggle(checkbox) {
if (checkbox.checked) {
setTimeout(() => checkbox.checked = false, 300); // —Å–±—Ä–æ—Å –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è
createMainOrder();
}
}

// === –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ ===
function createMainOrder() {
const num = document.getElementById('orderNum').value.trim();
if (!num) { alert('–£–∫–∞–∂–∏—Ç–µ ‚Ññ –∑–∞–∫–∞–∑–∞'); return; }
const tariffKey = document.getElementById('tariff').value;
const detail = document.getElementById('detail').value.trim() || '‚Äî';
const qty = parseInt(document.getElementById('qty').value) || 1;
const length = parseFloat(document.getElementById('length').value) || 0;
const width = parseFloat(document.getElementById('width').value) || 0;
const hours = parseFloat(document.getElementById('hours').value) || 0;
const amount = calculateAmount(tariffKey, length, width, hours, qty);
const shift = getCurrentShift();
if (!shift || !shift.active) { alert('‚ö†Ô∏è –ù–∞—á–Ω–∏—Ç–µ —Å–º–µ–Ω—É, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–∫–∞–∑—ã!'); return; }
const order = {
id: Date.now(),
orderNumber: num,
tariff: tariffKey,
detail: detail,
qty: qty,
length: length || null,
width: width || null,
hours: hours || null,
amount: amount,
date: todayYMD(),
shiftId: shift.id,
timestamp: new Date().toISOString()
};
const orders = loadOrders();
orders.push(order);
saveOrders(orders);
updateUI();
// –°–±—Ä–æ—Å –ø–æ–ª–µ–π
['orderNum','detail','qty','length','width','hours'].forEach(id => document.getElementById(id).value = '');
document.getElementById('qty').value = '1';
updateMainFormFields();
}

// === –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ===
function createPreorder() {
const num = document.getElementById('preOrderNum').value.trim();
if (!num) { alert('–£–∫–∞–∂–∏—Ç–µ ‚Ññ –ø—Ä–µ–¥–∑–∞–∫–∞–∑–∞'); return; }
const tariffKey = document.getElementById('preTariff').value;
const detail = document.getElementById('preDetail').value.trim() || '‚Äî';
const qty = parseInt(document.getElementById('preQty').value) || 1;
const length = parseFloat(document.getElementById('preLength').value) || 0;
const width = parseFloat(document.getElementById('preWidth').value) || 0;
const hours = parseFloat(document.getElementById('preHours').value) || 0;
const amount = calculateAmount(tariffKey, length, width, hours, qty);
const preorder = {
id: Date.now(),
orderNumber: num,
tariff: tariffKey,
detail: detail,
qty: qty,
length: length || null,
width: width || null,
hours: hours || null,
amount: amount,
date: todayYMD(),
timestamp: new Date().toISOString()
};
const preorders = loadPreorders();
preorders.push(preorder);
savePreorders(preorders);
alert('‚úÖ –ü—Ä–µ–¥–∑–∞–∫–∞–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!');
renderPreorders();
['preOrderNum','preDetail','preQty','preLength','preWidth','preHours'].forEach(id => document.getElementById(id).value = '');
document.getElementById('preQty').value = '1';
updatePreorderFormFields();
}
function acceptPreorder(preorderId, selectedDate = null) {
const preorders = loadPreorders();
const idx = preorders.findIndex(p => p.id === preorderId);
if (idx === -1) return;
const preorder = preorders[idx];
const shift = getCurrentShift();
if (!shift || !shift.active) { alert('–ù–∞—á–Ω–∏—Ç–µ —Å–º–µ–Ω—É, —á—Ç–æ–±—ã –ø—Ä–∏–Ω—è—Ç—å –ø—Ä–µ–¥–∑–∞–∫–∞–∑!'); return; }
if (!selectedDate) { openDateModal(preorderId); return; }
const order = { ...preorder, shiftId: shift.id, date: selectedDate };
const orders = loadOrders();
orders.push(order);
saveOrders(orders);
preorders.splice(idx, 1);
savePreorders(preorders);
alert(`‚úÖ –ü—Ä–µ–¥–∑–∞–∫–∞–∑ "${preorder.orderNumber}" –ø—Ä–∏–Ω—è—Ç –Ω–∞ –¥–∞—Ç—É ${formatDateYMD(selectedDate)}!`);
updateUI(); renderPreorders();
}
function deleteOrder(orderId) {
if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã?')) return;
const orders = loadOrders();
const idx = orders.findIndex(o => o.id === orderId);
if (idx === -1) return;
orders.splice(idx, 1);
saveOrders(orders);
const shift = getCurrentShift();
if (shift && shift.active) updateUI();
showOrdersByDate();
alert('‚úÖ –ó–∞–∫–∞–∑ —É–¥–∞–ª–µ–Ω!');
}
function deletePreorder(preorderId) {
if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã?')) return;
const preorders = loadPreorders();
const idx = preorders.findIndex(p => p.id === preorderId);
if (idx === -1) return;
preorders.splice(idx, 1);
savePreorders(preorders);
renderPreorders();
alert('‚úÖ –ü—Ä–µ–¥–∑–∞–∫–∞–∑ —É–¥–∞–ª–µ–Ω!');
}
function openDateModal(preorderId) {
pendingPreorderId = preorderId;
document.getElementById('modalDate').value = todayYMD();
document.getElementById('dateModal').classList.add('active');
}
function closeDateModal() {
document.getElementById('dateModal').classList.remove('active');
pendingPreorderId = null;
}
function confirmDateSelection() {
const date = document.getElementById('modalDate').value;
if (!date) { alert('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É'); return; }
if (pendingPreorderId !== null) acceptPreorder(pendingPreorderId, date);
closeDateModal();
}
function viewOrderDetails(orderId) {
const order = loadOrders().find(o => o.id === orderId);
if (!order) return;
const units = calculateUnits(order.tariff, order.length, order.width, order.hours, order.qty);
const tariffName = TARIFF_NAMES[order.tariff] || order.tariff;
let html = '';
html += `<div class="details-item"><span class="details-label">‚Ññ –∑–∞–∫–∞–∑–∞:</span><span class="details-value">${order.orderNumber}</span></div>`;
html += `<div class="details-item"><span class="details-label">–î–µ—Ç–∞–ª—å:</span><span class="details-value">${order.detail}</span></div>`;
html += `<div class="details-item"><span class="details-label">–¢–∞—Ä–∏—Ñ:</span><span class="details-value">${tariffName}</span></div>`;
html += `<div class="details-item"><span class="details-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</span><span class="details-value">${order.qty}</span></div>`;
if (order.length !== null) html += `<div class="details-item"><span class="details-label">–î–ª–∏–Ω–∞:</span><span class="details-value">${order.length} –º</span></div>`;
if (order.width !== null) html += `<div class="details-item"><span class="details-label">–®–∏—Ä–∏–Ω–∞:</span><span class="details-value">${order.width} –º</span></div>`;
if (order.hours !== null) html += `<div class="details-item"><span class="details-label">–ß–∞—Å—ã:</span><span class="details-value">${order.hours} —á</span></div>`;
html += `<div class="details-item"><span class="details-label">–û–±—ä–µ–º —Ä–∞–±–æ—Ç:</span><span class="details-value">${units.value} ${units.unit}</span></div>`;
html += `<div class="details-item"><span class="details-label">–°—É–º–º–∞:</span><span class="details-value">${order.amount.toFixed(2)} ‚ÇΩ</span></div>`;
document.getElementById('detailsContent').innerHTML = html;
document.getElementById('detailsModal').classList.add('active');
}
function closeDetailsModal() {
document.getElementById('detailsModal').classList.remove('active');
}
function openEditModal(orderId) {
const order = loadOrders().find(o => o.id === orderId);
if (!order) return;
editingOrder = order;
document.getElementById('editOrderId').value = order.id;
document.getElementById('editOrderNum').value = order.orderNumber;
document.getElementById('editDetail').value = order.detail;
document.getElementById('editTariff').value = order.tariff;
document.getElementById('editQty').value = order.qty;
document.getElementById('editLength').value = order.length || '';
document.getElementById('editWidth').value = order.width || '';
document.getElementById('editHours').value = order.hours || '';
updateEditFormFields();
document.getElementById('editModal').classList.add('active');
}
function closeEditModal() {
document.getElementById('editModal').classList.remove('active');
editingOrder = null;
}
function saveEditedOrder() {
if (!editingOrder) return;
const orderId = parseInt(document.getElementById('editOrderId').value);
const num = document.getElementById('editOrderNum').value.trim();
if (!num) { alert('–£–∫–∞–∂–∏—Ç–µ ‚Ññ –∑–∞–∫–∞–∑–∞'); return; }
const tariffKey = document.getElementById('editTariff').value;
const detail = document.getElementById('editDetail').value.trim() || '‚Äî';
const qty = parseInt(document.getElementById('editQty').value) || 1;
const length = parseFloat(document.getElementById('editLength').value) || 0;
const width = parseFloat(document.getElementById('editWidth').value) || 0;
const hours = parseFloat(document.getElementById('editHours').value) || 0;
const amount = calculateAmount(tariffKey, length, width, hours, qty);
const orders = loadOrders();
const idx = orders.findIndex(o => o.id === orderId);
if (idx !== -1) {
orders[idx] = {
...orders[idx],
orderNumber: num,
tariff: tariffKey,
detail: detail,
qty: qty,
length: length || null,
width: width || null,
hours: hours || null,
amount: amount
};
saveOrders(orders);
updateUI(); showOrdersByDate(); closeEditModal();
alert('‚úÖ –ó–∞–∫–∞–∑ –æ–±–Ω–æ–≤–ª–µ–Ω!');
}
}
function renderPreorders() {
const preorders = loadPreorders();
const container = document.getElementById('preordersList');
if (preorders.length === 0) {
container.innerHTML = '<div class="empty-msg">–ù–µ—Ç –ø—Ä–µ–¥–∑–∞–∫–∞–∑–æ–≤</div>';
return;
}
let html = `<table><thead><tr><th>‚Ññ</th><th>–î–µ—Ç–∞–ª—å</th><th>–°—É–º–º–∞</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead><tbody>`;
preorders.forEach(p => {
html += `<tr><td>${p.orderNumber}</td><td>${p.detail}</td><td class="amount">${p.amount.toFixed(2)} ‚ÇΩ</td><td>
<button class="btn-accept" onclick="acceptPreorder(${p.id})"><i class="fas fa-check"></i> –ü—Ä–∏–Ω—è—Ç—å</button>
<button class="btn-delete" onclick="deletePreorder(${p.id})"><i class="fas fa-trash"></i></button>
</td></tr>`;
});
html += '</tbody></table>';
container.innerHTML = html;
}
function showOrdersByDate() {
const date = document.getElementById('viewDate').value;
if (!date) { alert('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É'); return; }
const orders = loadOrders().filter(o => o.date === date);
const formattedDate = formatDateYMD(date);
let html = `<div class="date-label">–ó–∞–∫–∞–∑—ã –∑–∞ ${formattedDate}</div>`;
if (orders.length === 0) {
html += '<div class="empty-msg">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –∑–∞ —ç—Ç—É –¥–∞—Ç—É</div>';
} else {
html += `<table><thead><tr><th>‚Ññ</th><th>–î–µ—Ç–∞–ª—å</th><th>–°—É–º–º–∞</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead><tbody>`;
orders.forEach(o => {
html += `<tr><td>${o.orderNumber}</td><td>${o.detail}</td><td class="amount">${o.amount.toFixed(2)} ‚ÇΩ</td><td>
<button class="btn-view" onclick="viewOrderDetails(${o.id})" style="margin-right:4px;"><i class="fas fa-eye"></i></button>
<button class="btn-accept" onclick="openEditModal(${o.id})" style="background:linear-gradient(135deg,#2979ff,#2962ff);min-width:auto;padding:8px 10px;margin-right:4px;box-shadow:0 4px 15px rgba(41,121,255,0.3);"><i class="fas fa-edit"></i></button>
<button class="btn-delete" onclick="deleteOrder(${o.id})"><i class="fas fa-trash"></i></button>
</td></tr>`;
});
html += '</tbody></table>';
}
document.getElementById('ordersList').innerHTML = html;
}
function saveOrdersToFile() {
const date = document.getElementById('viewDate').value;
if (!date) { alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É'); return; }
const orders = loadOrders().filter(o => o.date === date);
if (orders.length === 0) { alert('–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –∑–∞ —ç—Ç—É –¥–∞—Ç—É'); return; }
const formattedDate = formatDateYMD(date);
let content = `–ó–ê–ö–ê–ó–´ –ó–ê ${formattedDate}\n========================\n`;
let totalSum = 0, totalM2 = 0, totalLinear = 0, totalTime = 0;
orders.forEach((o, idx) => {
const tariffName = TARIFF_NAMES[o.tariff] || o.tariff;
const units = calculateUnits(o.tariff, o.length, o.width, o.hours, o.qty);
content += `‚Ññ${idx + 1}. ${o.orderNumber}\n   ${o.detail} (${tariffName})\n`;
if (o.length) content += `   –î–ª–∏–Ω–∞: ${o.length} –º\n`;
if (o.width) content += `   –®–∏—Ä–∏–Ω–∞: ${o.width} –º\n`;
if (o.hours) content += `   –ß–∞—Å—ã: ${o.hours} —á\n`;
content += `   –ö–æ–ª-–≤–æ: ${o.qty}\n   –û–±—ä–µ–º: ${units.value} ${units.unit}\n   –°—É–º–º–∞: ${o.amount.toFixed(2)} ‚ÇΩ\n---\n`;
totalSum += o.amount;
if (units.unit === '–º¬≤') totalM2 += units.value;
else if (units.unit === '–ø–æ–≥. –º') totalLinear += units.value;
else if (units.unit === '—á–∞—Å—ã') totalTime += units.value;
});
content += `\n–ò–¢–û–ì–û: ${totalSum.toFixed(2)} ‚ÇΩ\n`;
if (totalM2 > 0) content += `–û–±—â–∞—è –ø–ª–æ—â–∞–¥—å: ${totalM2.toFixed(2)} –º¬≤\n`;
if (totalLinear > 0) content += `–û–±—â–∞—è –¥–ª–∏–Ω–∞: ${totalLinear.toFixed(2)} –ø–æ–≥. –º\n`;
if (totalTime > 0) content += `–û–±—â–µ–µ –≤—Ä–µ–º—è: ${totalTime.toFixed(1)} —á\n`;
content += `\n–≠–∫—Å–ø–æ—Ä—Ç: ${new Date().toLocaleString('ru-RU')}`;
const bom = new Uint8Array([0xEF, 0xBB, 0xBF]);
const blob = new Blob([bom, content], { type: 'text/plain;charset=utf-8' });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url; a.download = `–∑–∞–∫–∞–∑—ã_${formattedDate}.txt`;
document.body.appendChild(a); a.click(); document.body.removeChild(a);
URL.revokeObjectURL(url);
}
function saveOrdersToJSON() {
const date = document.getElementById('viewDate').value;
if (!date) { alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É'); return; }
const orders = loadOrders().filter(o => o.date === date);
if (orders.length === 0) { alert('–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –∑–∞ —ç—Ç—É –¥–∞—Ç—É'); return; }
const jsonContent = JSON.stringify(orders, null, 2);
const blob = new Blob([jsonContent], { type: 'application/json;charset=utf-8' });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url; a.download = `–∑–∞–∫–∞–∑—ã_${formatDateYMD(date)}.json`;
document.body.appendChild(a); a.click(); document.body.removeChild(a);
URL.revokeObjectURL(url);
}
document.getElementById('jsonImportInput').addEventListener('change', function(e) {
const file = e.target.files[0];
if (!file) return;
const reader = new FileReader();
reader.onload = function(event) {
try {
const content = event.target.result;
let importedOrders = [];
if (content.trim().startsWith('{') || content.trim().startsWith('[')) {
importedOrders = JSON.parse(content);
if (!Array.isArray(importedOrders)) importedOrders = [importedOrders];
} else {
importedOrders = parseTxtOrders(content);
}
if (importedOrders.length === 0) { alert('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∑–∞–∫–∞–∑—ã –≤ —Ñ–∞–π–ª–µ!'); return; }
const preorders = loadPreorders();
const newPreorders = importedOrders.map(item => ({
id: Date.now() + Math.random(),
orderNumber: item.orderNumber || '–ò–ú–ü-' + (preorders.length + 1),
tariff: item.tariff || 'RASPIL_M2',
detail: item.detail || '‚Äî',
qty: item.qty || 1,
length: item.length || null,
width: item.width || null,
hours: item.hours || null,
amount: typeof item.amount === 'number' ? item.amount : calculateAmount(
item.tariff || 'RASPIL_M2',
item.length || 0,
item.width || 0,
item.hours || 0,
item.qty || 1
),
date: todayYMD(),
timestamp: new Date().toISOString()
}));
savePreorders([...preorders, ...newPreorders]);
renderPreorders();
alert(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${newPreorders.length} –ø—Ä–µ–¥–∑–∞–∫–∞–∑–æ–≤!`);
} catch (err) {
console.error(err); alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞:\n' + err.message);
}
};
reader.readAsText(file, 'utf-8');
});
function parseTxtOrders(txtContent) {
const orders = [];
const blocks = txtContent.split('---\n');
for (const block of blocks) {
const lines = block.trim().split('\n').filter(line => line.trim() !== '');
if (lines.length < 3) continue;
const order = { orderNumber: '', detail: '', tariff: '', qty: 1, length: null, width: null, hours: null, amount: 0 };
let currentDetail = '', currentTariff = '';
for (const line of lines) {
const cleanLine = line.trim();
if (cleanLine.startsWith('‚Ññ') && cleanLine.includes('.')) {
const match = cleanLine.match(/‚Ññ\d+\.\s*(.+)/);
if (match) order.orderNumber = match[1].trim();
} else if (/^[A-Z0-9]/.test(cleanLine) && !cleanLine.includes(':') && !cleanLine.includes('–°—É–º–º–∞') && !cleanLine.includes('–ò–¢–û–ì–û')) {
if (!order.orderNumber && cleanLine.length > 2) order.orderNumber = cleanLine;
}
if (cleanLine.includes('(') && cleanLine.includes(')') && !cleanLine.includes('–°—É–º–º–∞')) {
const match = cleanLine.match(/(.+)\s*\((.+)\)/);
if (match) { currentDetail = match[1].trim(); currentTariff = match[2].trim(); }
}
if (cleanLine.startsWith('–î–ª–∏–Ω–∞:')) {
const match = cleanLine.match(/–î–ª–∏–Ω–∞:\s*([\d.]+)\s*–º/);
if (match) order.length = parseFloat(match[1]);
}
if (cleanLine.startsWith('–®–∏—Ä–∏–Ω–∞:')) {
const match = cleanLine.match(/–®–∏—Ä–∏–Ω–∞:\s*([\d.]+)\s*–º/);
if (match) order.width = parseFloat(match[1]);
}
if (cleanLine.startsWith('–ß–∞—Å—ã:')) {
const match = cleanLine.match(/–ß–∞—Å—ã:\s*([\d.]+)\s*—á/);
if (match) order.hours = parseFloat(match[1]);
}
if (cleanLine.startsWith('–ö–æ–ª-–≤–æ:')) {
const match = cleanLine.match(/–ö–æ–ª-–≤–æ:\s*(\d+)/);
if (match) order.qty = parseInt(match[1]);
}
if (cleanLine.startsWith('–°—É–º–º–∞:')) {
const match = cleanLine.match(/–°—É–º–º–∞:\s*([\d.]+)\s*‚ÇΩ/);
if (match) order.amount = parseFloat(match[1]);
}
}
if (currentTariff) {
const tariffMap = {'–†–∞—Å–ø–∏–ª':'RASPIL_M2','–õ–∏–Ω. —Ä–∞—Å–ø–∏–ª':'LINEAR_RASPIL','–°–∫–ª–µ–π–∫–∞ +':'SKLEIKA_OB','–°–∫–ª–µ–π–∫–∞ ‚Äì':'SKLEIKA_NO_OB','–ü–∞–∑—ã':'PAZY','–§–∞—Å–∫–∞':'FREZER_FASKA','–í—Ä–µ–º—è':'TIME'};
order.tariff = tariffMap[currentTariff] || 'RASPIL_M2';
}
order.detail = currentDetail || '‚Äî';
if (order.orderNumber) orders.push(order);
}
return orders;
}
document.addEventListener('DOMContentLoaded', () => {
document.getElementById('viewDate').value = todayYMD();
['tariff','preTariff','editTariff'].forEach(id => {
const el = document.getElementById(id);
if (el) el.addEventListener('change', () => {
if (id === 'tariff') updateMainFormFields();
else if (id === 'preTariff') updatePreorderFormFields();
else updateEditFormFields();
});
});
updateUI(); renderPreorders();
});
</script>
</body>
</html>
