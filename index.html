<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Неликвиды</title>
  <style>
    :root {
      --bg: #f9f9f9;
      --card-bg: #ffffff;
      --text: #333;
      --border: #e0e0e0;
      --shadow: rgba(0,0,0,0.06);
      --accent: #555;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #1a1a1a;
        --card-bg: #252525;
        --text: #eee;
        --border: #444;
        --shadow: rgba(0,0,0,0.2);
        --accent: #ddd;
      }
    }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    body {
      background: var(--bg);
      color: var(--text);
      padding: 16px;
      line-height: 1.5;
    }
    h1 {
      text-align: center;
      margin: 16px 0 20px;
      font-weight: 600;
      font-size: 1.4rem;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
      justify-content: center;
    }
    .filter-btn {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 6px 14px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 6px var(--shadow);
    }
    .filter-btn.active {
      background: var(--accent);
      color: white;
    }
    #search {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: var(--card-bg);
      color: var(--text);
      margin-bottom: 16px;
      font-size: 1rem;
      box-shadow: inset 0 1px 3px var(--shadow);
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 16px;
    }
    .item {
      background: var(--card-bg);
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 4px 12px var(--shadow);
      transition: transform 0.2s;
    }
    .item:hover {
      transform: translateY(-2px);
    }
    .item img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      background: #f0f0f0;
    }
    .item-info {
      padding: 10px;
    }
    .item-name {
      font-size: 0.9rem;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .item-price {
      font-weight: 600;
      font-size: 0.95rem;
      color: #d35400;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>

  <h1>Неликвиды</h1>

  <input type="text" id="search" placeholder="Поиск по названию..." />

  <div class="controls" id="category-buttons">
    <!-- Кнопки категорий будут сюда -->
  </div>

  <div class="grid" id="items-container">
    <!-- Товары будут сюда -->
  </div>

  <script>
    // Загрузка данных
    fetch('items.json')
      .then(res => res.json())
      .then(items => {
        const container = document.getElementById('items-container');
        const btnContainer = document.getElementById('category-buttons');
        const searchInput = document.getElementById('search');

        // Только доступные
        const availableItems = items.filter(item => item.available !== false);

        // Уникальные категории
        const categories = [...new Set(availableItems.map(i => i.category || 'без категории'))].sort();
        const allCategories = ['все', ...categories];

        // Создаём кнопки
        allCategories.forEach(cat => {
          const btn = document.createElement('button');
          btn.className = 'filter-btn';
          btn.textContent = cat === 'все' ? 'все' : cat;
          btn.dataset.category = cat;
          btn.addEventListener('click', () => filterItems(cat));
          btnContainer.appendChild(btn);
        });

        // Активируем первую кнопку ("все")
        let currentCategory = 'все';
        btnContainer.querySelector('[data-category="все"]').classList.add('active');

        // Рендер всех карточек
        function renderItems(itemsToShow) {
          container.innerHTML = '';
          itemsToShow.forEach(item => {
            const div = document.createElement('div');
            div.className = 'item';
            div.dataset.category = item.category || 'без категории';
            div.innerHTML = `
              <img src="${item.photo || 'https://via.placeholder.com/140?text=Нет+фото'}" onerror="this.src='https://via.placeholder.com/140?text=Нет+фото'">
              <div class="item-info">
                <div class="item-name">${item.name || 'Без названия'}</div>
                <div class="item-price">${item.price || '?'} ₽</div>
              </div>
            `;
            container.appendChild(div);
          });
        }

        // Фильтрация
        function filterItems(category) {
          // Обновляем активную кнопку
          document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
          document.querySelector(`[data-category="${category}"]`).classList.add('active');
          currentCategory = category;

          let filtered = availableItems;
          if (category !== 'все') {
            filtered = availableItems.filter(i => (i.category || 'без категории') === category);
          }

          const query = searchInput.value.trim().toLowerCase();
          if (query) {
            filtered = filtered.filter(i => (i.name || '').toLowerCase().includes(query));
          }

          renderItems(filtered);
        }

        // Поиск в реальном времени
        searchInput.addEventListener('input', () => filterItems(currentCategory));

        // Первый рендер
        renderItems(availableItems);
      })
      .catch(err => {
        document.getElementById('items-container').innerHTML = '<p>Ошибка загрузки товаров. Проверьте файл items.json.</p>';
        console.error(err);
      });
  </script>
</body>
</html>
